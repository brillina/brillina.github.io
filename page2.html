<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Mask Usage</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            text-align: center;
            width: 120px;
            height: auto;
            padding: 2px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
        #map {
            position: relative;
        }
        #scatterplot {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Dropdown Menu -->
    <label for="select-state">Select a State:</label>
    <select id="select-state">
        <!-- <option value="all">All States</option> -->
    </select>
    <div id="map"></div>
    <div id="scatterplot"></div> <!-- Scatterplot will be rendered here -->
    <script src="script2.js"></script>
    <p>
        <a class="btn btn-primary btn-s" href="index.html" role="button">Previous</a>
        <a class="btn btn-primary btn-s" href="page2.html" role="button">Next</a>
    </p>
    <script>// Function to load and process data
        async function loadData() {
            const casesDeathsData = await d3.csv("data/total_cases_deaths_per_county.csv");
            const maskData = await d3.csv("data/mask_frequency.csv");
        
            const mergedData = casesDeathsData.map(casesRow => {
                const maskRow = maskData.find(maskRow => maskRow.fips === casesRow.fips);
                if (maskRow) {
                    return {
                        ...casesRow,
                        ...maskRow
                    };
                }
                return null;
            }).filter(row => row !== null);
        
            return mergedData;
        }
        
        // Function to render scatterplot
        async function renderScatterplot() {
            const data = await loadData();
            if (data.length === 0) {
                console.error("No data available for scatterplot.");
                return;
            }
        
            const margin = { top: 10, right: 20, bottom: 30, left: 50 },
                width = 1000 - margin.left - margin.right,
                height = 800 - margin.top - margin.bottom;
        
            let svg = d3.select("#scatterplot").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
            // Add X axis
            const x = d3.scaleLinear()
                .domain([0, d3.max(data, d => +d.cases)])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x).tickFormat(d => d));
        
            // Add Y axis
            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => +d.ALWAYS)])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y).tickFormat(d => d));
        
            // Add dots
            svg.append('g')
                .selectAll("scatterplot-dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", d => x(+d.cases))
                .attr("cy", d => y(+d.ALWAYS))
                .attr("r", 5)
                .style("fill", "blue");
        
            // Add tooltip
            const tooltip = d3.select("#scatterplot")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "black")
                .style("border-radius", "5px")
                .style("padding", "10px")
                .style("color", "white");
        
            svg.selectAll("circle")
                .on("mouseover", (event, d) => {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`Cases: ${d.cases}<br>Always: ${d.ALWAYS}`)
                        .style("left", (event.pageX + 5) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        }
        
        renderScatterplot();
        </script>
</body>
</html>
